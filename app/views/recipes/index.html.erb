<div class="container-index">
  <div class="index-layout">
    <div class="search-card">

      <div data-controller="search-recipes">
      <p id="filter">Enter your ingredients, comma seperated</p>
      <form id="form" role="search">
           <%= text_field_tag :query,
              params[:query],
              class: "form-control",
              placeholder: "Add more ingredients",
              'data-search-recipes-target': "form"
            %>
            <%= button_tag(type: "submit", class: "btn btn-default") do %>
            <i class="fa-solid fa-magnifying-glass"></i>
            <% end %>
      </form>

  <div data-search-recipes-target="ingredients">
    <% if @search_ingredients.present? %>
    <% newingredients = @search_ingredients.split(", ") %>
        <div class="current-search">
          <h2>Current ingredients</h2>
          <% newingredients.each do |ingredient| %>
          <% next if ingredient.empty? %>
            <div class="current">
              <%= button_tag(type: "submit", class: "btn btn-default", data: {action: "click->search-recipes#removeIngredient"}) do %>
              <div class="ingr">
                 <p><%= ingredient %></p>
                <div data-search-recipes-target="ingredientlist"><i class="fa-solid fa-x"></i></div>
              </div>
              <% end %>
            </div>
          <% end %>
        </div>
    <% end %>
    </div>
    </div>

      <div class ="dietary">
        <h2>Dietary restrictions</h2>
        <div class="check">
          <div class="box"><input type="checkbox" id="vegan" name="vegan" value="Dietary">
          <label for="vegan"> Vegan</label></div>
          <div class="box"><input type="checkbox" id="vegetarian" name="vegetarian" value="Dietary">
          <label for="vegetarian"> Vegetarian</label></div>
          <div class="box"><input type="checkbox" id="gluten-free" name="gluten-free" value="Dietary">
          <label for="gluten-free"> Gluten free</label></div>
          <div class="box"><input type="checkbox" id="lactose-free" name="lactose-free" value="Dietary">
          <label for="lactose-free"> Lactose free</label></div>
        </div>
      </div>

      <div class ="dietary">
        <h2>Cooking Time</h2>
        <%# NOT USABLE YET %>
        <div class="check">
         <form id="form" role="search">
        <%= radio_button_tag(:cookingTime, "all") %>
        <%= label_tag(:cookingTime_all, "Show all") %>
        <%= radio_button_tag(:cookingTime, "30") %>
        <%= label_tag(:cookingTime_30, "< 30 min") %>
        <%= radio_button_tag(:cookingTime, "45") %>
        <%= label_tag(:cookingTime_45, "< 45 min") %>
        <%= radio_button_tag(:cookingTime, "60") %>
        <%= label_tag(:cookingTime_60, "< 60 min") %>

          <%= submit_tag "Search" %>
        </form>
        </div>
      </div>


      <div class="your-list">
        <h2>Your pantry items</h2>
          <div class="items">
            <p>You currently have no items added on your list</p>
            <p><strong>Click here</strong> to go to list</p>
          </div>
      </div>
    </div>

  <%# ---------Recipe Results page ----------%>
  <% if @recipes.empty? %>
    <div class="no-recipes">
      <img src="recipe1-not-found.png",>
      <h2>Sorry! We don't have anything for your search</h2>
    </div>
  <% else %>
    <div class="card-holder">
         <% @recipes.each do |recipe| %>
          <div class="card-recipe">
          <% if recipe.photo.key %>
            <%= link_to cl_image_tag(recipe.photo.key), recipe_path(recipe), height: 300, width: 400, crop: :fill %>
          <% else %>
            <%= image_tag "logo.png", height: 300, width: 400, crop: :fill %>
          <% end %>

              <div class="card-recipe-infos pt-2 px-3">
                <h2><i class="fa-regular fa-clock"> <%= recipe.cookingTime %></i> min</h2>
                <%# CHECKS IF USER IS SIGNED IN + FAVO / UNFAVO OPTION %>
                <div class="card-recipe card-recipe-quickview"  data-bs-toggle="modal" data-bs-target="#exampleModal<%= recipe.id %>">
                  <i class="fa-solid fa-expand"></i>
                </div>
                <% if user_signed_in? %>
                   <% if current_user.favorited?(recipe) %>
                      <div class="card-recipe-heart">
                        <%= link_to unfavorite_recipe_path(recipe),  data: { turbo_method: "post" } do %>
                          <h2><i class="fa-solid fa-heart"></i></h2>
                        <% end %>
                      </div>
                    <% else %>
                      <div class="card-recipe-heart">
                        <%= link_to favorite_recipe_path(recipe), data: { turbo_method: "post" } do %>
                          <h2><i class="fa-regular fa-heart"></i></h2>
                        <% end %>
                      </div>
                    <% end %>
              <%# IF USER NOT SIGNED IN, REFER TO SIGN UP PAGE WHEN THEY FAVO %>
                <% else %>
                  <div class="card-recipe-heart">
                    <%= link_to new_user_registration_path do %>
                      <h2><i class="fa-regular fa-heart"></i></h2>
                    <% end %>
                  </div>
                <% end %>

              <h2><%= link_to recipe.title, recipe_path(recipe) %></h2>
                <p><strong>Ingredients:</strong> <%=  %><BR>
                <% @ingredients = JSON.parse(recipe.ingredients) %>

                <% @ingredients.each do |ingredient| %>
                  <% ingredient.uniq.each do |ing|%>
                      <%= ing.capitalize %>,
                  <% end %>
                <% end %>

                <!-- Modal for pop up recipe -->
                <div class="modal fade" id="exampleModal<%= recipe.id %>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel"><%= recipe.title %></h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <h2>Instructions</h2>
                          <% @instructions = JSON.parse(recipe.description) %>
                        <ol>
                          <% @instructions.each do |instruction| %>
                            <li><%= instruction %></li>
                          <% end %>
                        </ol>
                      </div>
                      <div class="modal-footer">
                        <%= link_to "Show full Recipe", recipe_path(recipe), class: "btn-call" %>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
